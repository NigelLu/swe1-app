dist: xenial

os: linux

arch: x86_64

language: python

python:
    - 3.8

env:
    global:
        - PGPORT=5432
        - PGUSER=postgres

services:
    - postgresql

addons:
    postgresql: "15.4"
    apt:
        packages:
            - postgresql-15
            - postgresql-client-15

before_script:
    # * please ALWAYS run "python manage.py makemigrations" before pushing to GitHub
    # * to ensure migration files are up-to-date
    - psql -c "CREATE DATABASE $RDS_DB_NAME;" -U postgres
    - psql -c "CREATE USER $RDS_USERNAME WITH ENCRYPTED PASSWORD '$RDS_PASSWORD';"
    - psql -c "ALTER DATABASE $RDS_DB_NAME OWNER TO $RDS_USERNAME;"
    - python manage.py migrate

install:
    - pip install -r requirements.txt

script:
    - black --check .
    - flake8 .
    - coverage run manage.py test

after_success:
    - coveralls
